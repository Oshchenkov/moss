@using EC.Models.Database
@using EC.App_LocalResources;
@using Resources = EC.Localization.Resources
@{

    bool? is_cc = ViewBag.is_cc;
    if (!is_cc.HasValue)
    {
        is_cc = false;
    }
    String class_ext = ViewBag.cc_extension;
    //bool? is_cc = true;
    //String class_ext = "";
    //if (is_cc)
    //{
    //    class_ext = "_cc";
    //}

    ViewBag.Title = GlobalRes.SelectYourCompany;
    Layout = "~/Views/Shared/HeaderFooterFrontPages.cshtml";
    //ViewBag.background = "background-image: url(/Content/img/website-report" + class_ext + ".jpg);";
}

<div id="topBody">
    <div class="firstTitle">
        @GlobalRes.FileReport
    </div>
    <div class="secondTitle">
        @GlobalRes.FindOrganization
    </div>
    <div class="thirdTitle">
        <div class="widthThirdTitle">
            <input id="specialInput" placeholder="Company name or code" type="text">
            <div id="buttonStart"><span class="buttonStartText">@GlobalRes.Start.ToUpper()</span></div>
            <ul id="dropDownList" style="display: none">
            </ul>
        </div>
    </div>
</div><!--end topBody-->
<div id="bottomBody@{@class_ext}">

    <div class="fourthTitle">
        @GlobalRes.DontSilentBystander
    </div>
    <div class="icons">
        <div class="centerBlock">
            <div class="itemBlock">
                <div class="empty"></div>
                <div class="positionIcons">
                    <div id="firstIcon"></div>
                </div>
                <span class="title">@GlobalRes.ActEarly,<br />@GlobalRes.ActEthically</span><br />
                <span class="textBlock">
                    @GlobalRes.Ifyouwitness
                </span>
            </div>

            <div class="itemBlock">
                <div class="empty"></div>
                <div class="positionIcons">
                    <div id="secondIcon"></div>
                </div>
                <span class="title">@GlobalRes.ReportWeb, <br />@GlobalRes.TabletMobile</span><br />
                <span class="textBlock">
                    @GlobalRes.Useonline
                </span>
            </div>

            <div class="itemBlock">
                <div class="empty"></div>
                <div class="positionIcons">
                    <div id="thirdIcon"></div>
                </div>
                <span class="title">@GlobalRes.Chooseyour  <br />@GlobalRes.ConfidentialityLevel</span><br />
                <span class="textBlock">
                    @GlobalRes.ReportAnon
                </span>
            </div>

            <div class="itemBlock">
                <div class="empty"></div>
                <div class="positionIcons">
                    <div id="fourthIcon"></div>
                </div>
                <span class="title">@GlobalRes.Expecta <br />@GlobalRes.Response</span><br />
                <span class="textBlock">
                    @GlobalRes.Mediatorswillgetback
                </span>
            </div>
        </div><!-- end centerBlock-->
    </div><!--end icons-->
</div><!--end bottomBody-->
<input id="companyCode" type="hidden" value="false" />
@section pageScripts{
    <script>
        var input = document.getElementById("specialInput");
        input.oninput = function (event) {
            let lookup = {'event':event.currentTarget.value } ;
            let len = lookup.event.length;
            if (len >= 3) {
                //go ajax call
                let temp = loadDoc(lookup);
            }
            //document.getElementById('result').innerHTML = input.value;
        };
        
        function loadDoc(lookup) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                xmlhttp.onreadystatechange = function (event) {
                    if (this.readyState == 4 && this.status == 200) {
                        lookup.result = JSON.parse(event.currentTarget.response);
                        if (lookup.result.length > 0) {
                            lookup.result.forEach(function (item, i, arr) {
                                addElementDropDownList(item.label, item.value);
                            });
                        }
                    }
                };
            };
            let link = window.location.href + "Index/CompanyLookup?lookup=" + lookup.event;
            xmlhttp.open("POST", link, true);
            xmlhttp.send();
        }
        function addElementDropDownList(label, value) {
            var listLi = document.getElementById("dropDownList");
            if(label != "" && value != "") {
                listLi.style.display = "block";
                var node = document.createElement("LI");
                node.innerHTML = "<div>" + value + "</div>"; 
                node.setAttribute("value", label);
                node.onclick = function (event) {
                    document.getElementById("dropDownList").innerHTML = "";
                    let textContent = event.currentTarget.textContent;
                    let value = event.currentTarget.getAttribute('value');
                    document.getElementById("companyCode").setAttribute('value', value);
                    SetInputStart(textContent);
                };
                listLi.appendChild(node);
            }
            
            
        }
        function SetInputStart(textContent) {
            if (textContent.length > 1) {
                document.getElementById("specialInput").value = textContent;

                //buttonStartText
                
                document.getElementById("buttonStart").onclick = function () {
                    var companyCode = document.getElementById("companyCode").getAttribute('value');
                    if (companyCode != "") {
                        window.location.href = "/Report/new?companyCode=" + companyCode;
                    }
                }
            }
            
            
        }
    </script>

}





