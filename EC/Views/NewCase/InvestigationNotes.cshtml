@using EC.App_LocalResources
@using EC.Models.Database;

@{
    var report_id = (Int32)ViewBag.report_id;
    var user_id = (Int32)ViewBag.user_id;
    List<attachment> attachmentFiles = (List<attachment>)ViewBag.attachmentFiles;
    Layout = "~/Views/Shared/IndexPages/LayoutCasesNewReport.cshtml";
}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,600,700" rel="stylesheet">

<link href="@Url.Content("~/Content/assets/template/css/reset.css")" rel="stylesheet">
<link href="@Url.Content("~/Content/assets/template/css/style.css")" rel="stylesheet">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

@Html.Partial("~/Views/Shared/Partial/_NewCasesTopMenu.cshtml")

<!-- Main jumbotron for a primary marketing message or call to action -->

<section class="types-section left" ng-controller="NewCaseInvestigationNotesController">

    <div class="menu-buttom ninja-btn">
        <a href="#"></a>
    </div>
    <div class="center">
        <!--Incident types-->
        <div class="flex incident-types someBorder">
            <div class="item">
                <p class="fact-title">Incident types</p>
                <ul>
                    <li ng-repeat="item in model.report_secondary_type_selected">
                        <a href="#" ng-click="incidentTypeDelete(item.id)" ng-show="!item.added_by_reporter">X</a>
                        {{item.secondary_type_en}}
                    </li>
                </ul>
                <a href="#" class="green--button incident-types--button" ng-show="!incidentTypeAddMode && model.report_secondary_type_selected_avilable.length > 0" ng-click="incidentTypeAddMode = !incidentTypeAddMode">
                    Add incident type
                </a>
                <dropbox ng-show="incidentTypeAddMode"
                         text="Select one"
                         itemText="{{item.secondary_type_en}}"
                         ng-dropbox-list="model.report_secondary_type_selected_avilable"
                         ng-dropbox-rootItem=""
                         ng-dropbox-on-select="incidentTypeAdd">
                </dropbox>
            </div>

            <div class="item">
                <p class="fact-title">Involved Departments</p>
                <ul>
                    <li ng-repeat="item in model.departments_report">
                        <a href="#" ng-click="departmentDelete(item.id)" ng-show="!item.added_by_reporter">X</a>
                        {{item.name}}
                    </li>
                </ul>
                <a href="#" class="green--button incident-types--button" ng-show="!departmentAddMode && model.departments_all.length > 0" ng-click="departmentAddMode = !departmentAddMode">
                    Add department
                </a>
                <dropbox ng-show="departmentAddMode"
                         text="Select one"
                         itemText="{{item.department_en}}"
                         ng-dropbox-list="model.departments_all"
                         ng-dropbox-rootItem=""
                         ng-dropbox-on-select="departmentAdd">
                </dropbox>
            </div>
        </div>
        <div class="flex incident-types specFlex">
            <div class="item">
                <p class="fact-title">Involved Parties</p>
                <ul>
                    <li ng-repeat="item in model.mediator_involved">
                        <a href="#" ng-click="mediatorDelete(item.id)" ng-show="!item.added_by_reporter">X</a>
                        {{item.first_nm}} {{item.last_nm}}
                    </li>
                    <li ng-repeat="item in model.mediator_not_involved">
                        <a href="#" ng-click="mediatorDelete(item.id, 2)" ng-show="!item.added_by_reporter">X</a>
                        {{item.Name}} {{item.last_name}} {{item.Title}}
                    </li>                    
                </ul>
                <a href="#" class="green--button incident-types--button" ng-show="!mediatorAddMode" ng-click="mediatorAddMode = !mediatorAddMode">Add person</a>
                <div ng-show="mediatorAddMode">
                    <div class="addPerson">
                        <div class="addPersonName sampleContainer">
                            <div class="personTitle title">@GlobalRes.FirstNameUp</div>
                            <div class="personData">
                                <input name="personName" class="personDataTextBox fName" ng-class="{error : !addPerson.FirstName}" ng-model="addPerson.FirstName" />
                            </div>
                        </div>

                        <div class="addPersonName sampleContainer">
                            <div class="personTitle title">@GlobalRes.LastNameUp</div>
                            <div class="personData">
                                <input name="personLastName" class="personDataTextBox lName" ng-class="{error : !addPerson.LastName}" ng-model="addPerson.LastName" />
                            </div>
                        </div>

                        <div class="addPersonInfo sampleContainer">
                            <div class="personTitle title">@GlobalRes.Title</div>
                            <div class="personData">
                                <input type="text" name="personTitle" class="personDataTextBox witnessTitle" ng-class="{error : !addPerson.Title}" ng-model="addPerson.Title" />
                            </div>
                        </div>
                        <dropbox
                                 ng-class="{errorDropbox : addPerson.Role.id == 0}" 
                                 ng-dropbox-textexpr="addPerson.Role.role_en"
                                 itemText="{{item.role_en}}"
                                 ng-dropbox-list="model.addNewPersonRoles"
                                 ng-dropbox-rootItem=""
                                 ng-dropbox-on-select="addPerson.Role"
                                 >
                        </dropbox>
                        <a href="#" class="green--button incident-types--button" ng-click="addNewPerson()">@GlobalRes.AddPerson</a>
                    </div>
                </div>
            </div>
        </div>
        <!--Facts Established-->
        <div class="border-top facts-margin facts-padding facts-established">
            <p class="fact-title">Facts Established</p>
            <div class="">
                <textarea class="facts-established--text" ng-model="model.note1" ng-show="editNote1"> </textarea>
                <p ng-show="!editNote1">{{model.note1}}</p>
                <a href="#" class="green--button facts--submit" ng-show="editNote1" ng-click="saveNote(1)">Save</a>
                <a href="#" class="green--button facts--submit" ng-show="!editNote1" ng-click="editNote1 = true">
                    {{model.note1 || '' !== '' ? 'Edit' : 'Add'}}
                </a>
            </div>
        </div>

        <!--Investigation Methodology-->
        <div class="border-top facts-margin facts-padding facts-established">
            <p class="fact-title">Investigation Methodology</p>
            <div class="">
                <textarea class="facts-established--text" ng-model="model.note2" ng-show="editNote2"> </textarea>
                <p ng-show="!editNote2">{{model.note2}}</p>
                <a href="#" class="green--button facts--submit" ng-show="editNote2" ng-click="saveNote(2)">Save</a>
                <a href="#" class="green--button facts--submit" ng-show="!editNote2" ng-click="editNote2 = true">
                    {{model.note2 || '' !== '' ? 'Edit' : 'Add'}}
                </a>
            </div>
        </div>

        <!--Root Cause Investigation-->
        <div class="border-top facts-margin facts-padding ">
            <p class="fact-title">Root Cause Investigation</p>

            <!--Academic Misconduct-->
            <div class="investigation flex space-between" ng-repeat="item in model.report_secondary_type_selected">
                <div class="investigation--title">{{item.secondary_type_en}}</div>
                <div class="investigation__item flex flex-column">

                    <div class="investigation__inner">
                        <dropbox ng-dropbox-textExpr="getBehavioralFactors(item)"
                                 itemText="{{item.name_en}}"
                                 ng-dropbox-list="model.company_root_cases_behavioral"
                                 ng-dropbox-rootItem="item"
                                 ng-dropbox-on-select="changeBehavioralFactors">
                        </dropbox>
                    </div>
                    <div class="">
                        <textarea class="facts-established--text" cols="20" rows="5" ng-model="item.inv_meth_bf_note" ng-show="item.behavioralEditMode"></textarea>
                        <p ng-show="!item.behavioralEditMode">{{item.inv_meth_bf_note}}</p>
                        <a href="#" class="green--button facts--submit" ng-click="item.behavioralEditMode = !item.behavioralEditMode" ng-show="!item.behavioralEditMode">
                            {{item.inv_meth_bf_note != '' ? 'Edit note' : 'Add note'}}
                        </a>
                        <a href="#" class="green--button facts--submit" ng-show="item.behavioralEditMode" ng-click="saveNoteBehavioralFactors(item)">
                            Save
                        </a>

                    </div>
                    <div class="investigation__inner">
                        <dropbox ng-dropbox-textExpr="getExternalInfluences(item)"
                                 itemText="{{item.name_en}}"
                                 ng-dropbox-list="model.company_root_cases_external"
                                 ng-dropbox-rootItem="item"
                                 ng-dropbox-on-select="changeExternalInfluences">
                        </dropbox>
                    </div>
                    <div class="">
                        <textarea class="facts-established--text" ng-model="item.inv_meth_ei_note" ng-show="item.externalInfluencesEditMode"></textarea>
                        <p ng-show="!item.externalInfluencesEditMode">{{item.inv_meth_ei_note}}</p>
                        <span class="green--button facts--submit" ng-click="item.externalInfluencesEditMode = !item.externalInfluencesEditMode" ng-show="!item.externalInfluencesEditMode">
                            {{item.inv_meth_ei_note != '' ? 'Edit note' : 'Add note'}}
                        </span>
                        <a href="#" class="green--button facts--submit" ng-show="item.externalInfluencesEditMode" ng-click="saveNoteExternalInfluences(item)">
                            Save
                        </a>
                    </div>
                    <div class="investigation__inner">
                        <dropbox ng-dropbox-textExpr="getCampusInfluences(item)"
                                 itemText="{{item.name_en}}"
                                 ng-dropbox-list="model.company_root_cases_organizational"
                                 ng-dropbox-rootItem="item"
                                 ng-dropbox-on-select="changeCampusInfluences">
                        </dropbox>
                    </div>
                    <div class="">
                        <textarea class="facts-established--text" ng-model="item.inv_meth_ci_note" ng-show="item.campusInfluencesEditMode"></textarea>
                        <p ng-show="!item.campusInfluencesEditMode">{{item.inv_meth_ci_note}}</p>
                        <span class="green--button facts--submit" ng-click="item.campusInfluencesEditMode = !item.campusInfluencesEditMode" ng-show="!item.campusInfluencesEditMode">
                            {{item.inv_meth_ci_note != '' ? 'Edit note' : 'Add note'}}
                        </span>
                        <a href="#" class="green--button facts--submit" ng-show="item.campusInfluencesEditMode" ng-click="saveNoteCampusInfluences(item)">
                            Save
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel-overlay"></div>

</section>
@*
    <script src="@Url.Content("~/Content/assets/template/js/select.js")"></script>
*@